<!DOCTYPE html>
<html lang="zh-CN">





<head><meta name="generator" content="Hexo 3.9.0">
    <meta charset="UTF-8">
    <link rel="apple-touch-icon" sizes="76x76" href="/img/favicon.ico">
    <link rel="icon" type="image/png" href="/img/favicon.ico">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="description" content="Programming">
    <meta name="author" content="Haojen Lau">
    <meta name="keywords" content>
    <title>De1ta-CTF-2020-Review - buki</title>
    <link rel="stylesheet" href="/lib/font-awesome/css/all.min.css?v=5.7.2">
    <link rel="stylesheet" href="/lib/mdbootstrap/css/bootstrap.min.css?v=4.3.1">
    <link rel="stylesheet" href="/lib/mdbootstrap/css/mdb.min.css?v=4.8.7">
    <link rel="stylesheet" href="/lib/github-markdown/github-markdown.min.css">
    <link rel="stylesheet" href="/lib/nprogress/nprogress.css?v=0.2.0">
    <link rel="stylesheet" href="//at.alicdn.com/t/font_1067060_qzomjdt8bmp.css">
    
        <link rel="stylesheet" href="/lib/prettify/tomorrow-night-eighties.min.css">
    
    <link rel="stylesheet" href="/css/main.css">

    
</head>


<body>
<header style="height: 30vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
<div class="container">
    <a class="navbar-brand" href="/">&nbsp;<strong>buki</strong>&nbsp;</a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
        aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
        <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <ul class="navbar-nav ml-auto text-center">
            
            <li class="nav-item">
                <a class="nav-link" href="/">Home</a>
            </li>
            
            <li class="nav-item">
                <a class="nav-link" href="/archives/">Archives</a>
            </li>
            
            <li class="nav-item">
                <a class="nav-link" href="/categories/">Categories</a>
            </li>
            
            <li class="nav-item">
                <a class="nav-link" href="/tags/">Tags</a>
            </li>
            
            <li class="nav-item">
                <a class="nav-link" href="/about/">About</a>
            </li>
            
        </ul>
    </div>
</div>


</nav>
    <div class="view intro-2"
         style="background: url('/img/post.jpg')no-repeat center center;background-size: cover;">
        <div class="full-bg-img">
            <div class="mask rgba-black-light flex-center">
                <div class="container text-center white-text wow fadeInUp">
                    <span class="h2" id="subtitle">
                        
                    </span>
                    
                        <br>
                        <p>星期一, 五月 11日 2020, 2:31 下午</p>
                    
                </div>
            </div>
        </div>
    </div>
</header>

<main>
    
        

<div class="container-fluid">
    <div class="row">
        <div class="d-none d-lg-block col-lg-2"></div>
            <div class="col-lg-8 nopadding-md">
                <div class="py-5 z-depth-3 board">
                    <div class="post-content mx-auto">
                        <div class="markdown-body">
                            <p>Only review in Crypto.</p>
<h1 id="nlfsr-unsolved"><a href="#nlfsr-unsolved" class="headerlink" title="nlfsr(unsolved)"></a>nlfsr(unsolved)</h1><p>This challenge consists of 4 linear feedback shift registers (below I use LFSR instead), with accordingly 19 bits, 19 bits, 6 bits and 3 bits state length. Here is the given file:</p>
<p><strong>quiz.py</strong></p>
<pre><code class="python">from flag import a, b, c, d, flag
assert flag == &quot;De1CTF{&quot; + &#39;&#39;.join([hex(i)[2:] for i in [a, b, c, d]]) + &quot;}&quot;
assert [len(bin(i)[2:]) for i in [a, b, c, d]] == [19, 19, 13, 6]

ma, mb, mc, md = 0x505a1, 0x40f3f, 0x1f02, 0x31


def lfsr(r, m): return ((r &lt;&lt; 1) &amp; 0xffffff) ^ (bin(r &amp; m).count(&#39;1&#39;) % 2)


def combine():
    global a, b, c, d
    a = lfsr(a, ma)
    b = lfsr(b, mb)
    c = lfsr(c, mc)
    d = lfsr(d, md)
    [ao, bo, co, do] = [i &amp; 1 for i in [a, b, c, d]]
    return (ao*bo) ^ (bo*co) ^ (bo*do) ^ co ^ do


def genkey(nb):
    s = &#39;&#39;
    for i in range(nb*8):
        s += str(combine())
    open(&quot;data&quot;, &quot;w+&quot;).write(s)


genkey(128*1024)
</code></pre>
<p><strong>data</strong></p>
<pre><code>a string that comprises of 128*1024*8 bits(only zero or one)</code></pre><h2 id="Explanation"><a href="#Explanation" class="headerlink" title="Explanation"></a>Explanation</h2><p>There are four LFSR in quiz.py and each round, four LFSR simultaneously compute four according output. Then the combination function combines these four bits and output the combination result into file data.</p>
<h2 id="Condition"><a href="#Condition" class="headerlink" title="Condition"></a>Condition</h2><p>Since LFSR is the basic knowledge for us, there will more no more explanation on it. So let’s see what we have  got from the files.</p>
<blockquote>
<p>the initial state length of each LFSR</p>
<p>the taps of each LFSR</p>
<p>a combination function</p>
<p>many rounds combination results</p>
</blockquote>
<p>It seems to be a simple quiz because we have already known the taps of each LFSR. However, each output of four LFSR is combined as one bit, from which we can hardly retrieve the outputs of four LFSR. If we use pure brute-force attack method, the complexity would be:<br>$$<br>O(2^{47})<br>$$<br> Such a large scale. We must relate one or some output of four LFSR to the combination result and solve the each state independently. We can use a strategies called <strong>correlation attack</strong> in stream cipher.</p>
<h2 id="Details"><a href="#Details" class="headerlink" title="Details"></a>Details</h2><p>We first look into each possible situation of four LFSR and write down the result.</p>
<table>
<thead>
<tr>
<th>ao</th>
<th>bo</th>
<th>co</th>
<th>do</th>
<th>combine</th>
</tr>
</thead>
<tbody><tr>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>1</td>
</tr>
<tr>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>1</td>
</tr>
<tr>
<td>0</td>
<td>0</td>
<td>1</td>
<td>1</td>
<td>0</td>
</tr>
<tr>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr>
<td>0</td>
<td>1</td>
<td>0</td>
<td>1</td>
<td>0</td>
</tr>
<tr>
<td>0</td>
<td>1</td>
<td>1</td>
<td>0</td>
<td>0</td>
</tr>
<tr>
<td>0</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>0</td>
</tr>
<tr>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr>
<td>1</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>1</td>
</tr>
<tr>
<td>1</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>1</td>
</tr>
<tr>
<td>1</td>
<td>0</td>
<td>1</td>
<td>1</td>
<td>0</td>
</tr>
<tr>
<td>1</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>1</td>
</tr>
<tr>
<td>1</td>
<td>1</td>
<td>0</td>
<td>1</td>
<td>1</td>
</tr>
<tr>
<td>1</td>
<td>1</td>
<td>1</td>
<td>0</td>
<td>1</td>
</tr>
<tr>
<td>1</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>1</td>
</tr>
</tbody></table>
<p>In the table, ao represents the single output of LFSR-1 and so on. It is very obvious that ao has 75% correlation with the combination output, and we also know that if we have the correct initial state of LFSR-1,  three out of four output of LFSR-1 will be the same as the combination bits. As a result, we can independently search the initial state of LFSR-1, and the correct initial state should be the fittest one. Now the complexity comes down to:<br>$$<br>O(2^{19}+2^{28})=O({2^{28}})<br>$$<br>This is already considerable in brute-force attack method (I use approximately 3 hours with C++, half a day with python to solve). But sadly, outputs of other LFSR just has 50% correlation with the combination output (actually no correlation). We can look into the combination function:</p>
<pre><code>(ao*bo) ^ (bo*co) ^ (bo*do) ^ co ^ do</code></pre><p>And interestingly it can be transformed into:</p>
<pre><code>(ao*bo) ^ ((bo^1) * (co^do))</code></pre><p>Calculating the XOR result of co and do by ourselves, we can surprisingly find that there is correlation between (co^do) and the combination result. Try to write down the table again.</p>
<table>
<thead>
<tr>
<th>ao</th>
<th>bo</th>
<th>co^do</th>
<th>combine</th>
</tr>
</thead>
<tbody><tr>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr>
<td>0</td>
<td>0</td>
<td>1</td>
<td>1</td>
</tr>
<tr>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
</tr>
<tr>
<td>0</td>
<td>1</td>
<td>1</td>
<td>0</td>
</tr>
<tr>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr>
<td>1</td>
<td>0</td>
<td>1</td>
<td>1</td>
</tr>
<tr>
<td>1</td>
<td>1</td>
<td>0</td>
<td>1</td>
</tr>
<tr>
<td>1</td>
<td>1</td>
<td>1</td>
<td>1</td>
</tr>
</tbody></table>
<p>Again we can know from the table that (co^do) has 75% correlation with the combination output, which is the same as ao. There the complexity comes down again to:<br>$$<br>O(2^{19}+2^{9}+2^{19})=O(2^{20})<br>$$</p>
<p>The complexity is very considerable now.</p>
<h2 id="Realization"><a href="#Realization" class="headerlink" title="Realization"></a>Realization</h2><p>Official realization</p>
<pre><code class="python"># coding:utf8
import time


ma, mb, mc, md = 0x505a1, 0x40f3f, 0x1f02, 0x31
key = open(&quot;data&quot;).read()


def lfsr(r, m): return ((r &lt;&lt; 1) &amp; 0xffffff) ^ (bin(r &amp; m).count(&#39;1&#39;) % 2)


def calcR(x, y):
    assert len(x) == len(y)
    cnt = 0.0
    for i, j in zip(x, y):
        cnt += (i == j)
    return cnt / len(x)


def brutea(nb):
    relation, reala = 0, 0
    for i in range(0, 2 ** 19):
        s = &#39;&#39;
        a = i
        for j in range(nb * 8):
            a = lfsr(a, ma)
            s += str(a &amp; 1)
        r = calcR(s, key[:nb * 8])
        if relation &lt; r:
            relation, reala = r, i
    print(reala, relation)
    return reala


def brutecd(nb):
    relation, realc, reald = 0, 0, 0
    for i in range(0, 2 ** 6):
        d = i
        for j in range(0, 2 ** 13):
            c = j
            s = &#39;&#39;
            for k in range(nb * 8):
                c = lfsr(c, mc)
                d = lfsr(d, md)
                s += str((c &amp; 1) ^ (d &amp; 1))
            r = calcR(s, key[:nb * 8])
            if relation &lt; r:
                relation, realc, reald = r, j, i
    print(realc, reald, relation)
    return realc, reald


def bruteb(nb, a_, c_, d_):
    for i in range(0, 2 ** 19):
        b = i
        a, c, d = a_, c_, d_
        s = &#39;&#39;
        for j in range(nb * 8):
            a = lfsr(a, ma)
            b = lfsr(b, mb)
            c = lfsr(c, mc)
            d = lfsr(d, md)
            [ao, bo, co, do] = [k &amp; 1 for k in [a, b, c, d]]
            s += str((ao * bo) ^ (bo * co) ^ (bo * do) ^ co ^ do)
        if s == key[:nb * 8]:
            print(i)
            return i


if __name__ == &quot;__main__&quot;:
    start_time = time.time()
    print(start_time)
    a = brutea(20)
    c, d = brutecd(20)
    b = bruteb(20, a, c, d)
    &quot;De1CTF{%s}&quot; % (&#39;&#39;.join([hex(i)[2:] for i in [a, b, c, d]]))
    end_time = time.time()
    print(&quot;Used time:&quot;, end_time - start_time)
# De1CTF{58bb578d5611363f}</code></pre>
<p>Other challenges still remain confused.</p>
<h1 id="What-I-have-done"><a href="#What-I-have-done" class="headerlink" title="What I have done"></a>What I have done</h1><p>I spent half of my afternoon writing this article, and I still have a long way to go. Keep on learning IELTS and number theory.</p>
<h1 id="Things-to-Learn-and-Improve"><a href="#Things-to-Learn-and-Improve" class="headerlink" title="Things to Learn and Improve"></a>Things to Learn and Improve</h1><ul>
<li>How to use sage</li>
<li>Do a review on wangdibei</li>
</ul>
<h1 id="References"><a href="#References" class="headerlink" title="References"></a>References</h1><ul>
<li><a href="https://en.wikipedia.org/wiki/Correlation_attack" target="_blank" rel="noopener">https://en.wikipedia.org/wiki/Correlation_attack</a></li>
</ul>

                            <hr>
                        </div>
                        <br>
                        <div>
                            
                            <p>
                                <i class="iconfont icon-tag"></i>
                                
                                    <a class="hover-with-bg" href="/tags/Review">Review</a>
                                
                            </p>
                            
                                <p class="note note-warning">本博客所有文章除特别声明外，均采用 <a href="https://zh.wikipedia.org/wiki/Wikipedia:CC_BY-SA_3.0%E5%8D%8F%E8%AE%AE%E6%96%87%E6%9C%AC" rel="nofollow noopener">CC BY-SA 3.0协议</a> 。转载请注明出处！</p>
                            
                        </div>
                    </div>
                </div>
            </div>
        <div class="d-none d-lg-block col-lg-2 toc-container">
            
  <div id="toc">
    <p class="h4"><i class="far fa-list-alt"></i> Toc:</p> 
    <div id="tocbot"></div>
  </div>

        </div>
    </div>
</div>

<!-- custom -->


<!-- Comments -->
<div class="col-lg-7 mx-auto nopadding-md">
    <div class="container comments mx-auto" id="comments">
        
    </div>
</div>
    
</main>

<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<footer class="mt-5">
  <div class="text-center py-3">
    <span id="busuanzi_container_site_pv">
    <b>Total read: </b><span id="busuanzi_value_site_pv"></span> <b>times</b>
    </span><br>
    <span id="busuanzi_container_site_uv">
    <b>Total visit: </b><span id="busuanzi_value_site_uv"></span> <b>people</b>
    </span><br>
    <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><b>Hexo</b></a>
    <i class="iconfont icon-love"></i>
    <a href="https://github.com/0x2e/Material-T" target="_blank" rel="nofollow noopener"> <b>Material-T</b></a>
    <br>
    
  </div>
</footer>

  <!-- SCRIPTS -->
  <script src="/lib/mdbootstrap/js/jquery-3.4.1.min.js"></script>
  <script src="/lib/mdbootstrap/js/popper.min.js"></script>
  <script src="/lib/mdbootstrap/js/bootstrap.min.js?v=4.3.1"></script>
  <script src="/lib/mdbootstrap/js/mdb.min.js?v=4.8.7"></script>
  <script src="/lib/nprogress/nprogress.min.js?v=0.2.0"></script>
  <script src="/js/main.js"></script>
  
    
      <script src="/lib/tocbot/tocbot.min.js?v=4.7.0"></script>
    
    <script src="/js/post.js"></script>
  
  
    <script src="/lib/prettify/prettify.min.js?v=0.1.0"></script>
    <script>
      $(document).ready(function(){
        $('pre').addClass('prettyprint linenums');
        prettyPrint();
      })
    </script>
  
  
    <script src="/lib/typed/typed.min.js?v=2.0.9"></script>
    <script>
        var typed = new Typed('#subtitle', {
          strings: [
            '  ',
            "De1ta-CTF-2020-Review&nbsp;",
        ],
        cursorChar: "|",
        typeSpeed: 90,
        startDelay: 300, //开始之前延迟300毫秒
        loop: false,
        });
        $(".typed-cursor").addClass("h2");
    </script>
  
  
    <script src="/lib/anchor/anchor.min.js?v=4.2.0"></script>
    <script>
      anchors.options = {
        placement: "left",
        visible: "true",
        
      };
      anchors.add(".post-content > h1,h2,h3");
    </script>
  
</body>
</html>