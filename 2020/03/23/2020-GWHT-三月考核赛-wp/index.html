<!DOCTYPE html>
<html lang="zh-CN">





<head><meta name="generator" content="Hexo 3.9.0">
    <meta charset="UTF-8">
    <link rel="apple-touch-icon" sizes="76x76" href="/img/apple-touch-icon.png">
    <link rel="icon" type="image/png" href="/img/favicon.png">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="description" content="Programming">
    <meta name="author" content="Haojen Lau">
    <meta name="keywords" content>
    <title>2020_GWHT_三月考核赛_wp ~ w366er</title>
    <link rel="stylesheet" href="/lib/font-awesome/css/all.min.css?v=5.7.2">
    <link rel="stylesheet" href="/lib/mdbootstrap/css/bootstrap.min.css?v=4.3.1">
    <link rel="stylesheet" href="/lib/mdbootstrap/css/mdb.min.css?v=4.8.7">
    <link rel="stylesheet" href="/lib/github-markdown/github-markdown.min.css">
    <link rel="stylesheet" href="/lib/nprogress/nprogress.css?v=0.2.0">
    <link rel="stylesheet" href="//at.alicdn.com/t/font_1067060_qzomjdt8bmp.css">
    
        <link rel="stylesheet" href="/lib/prettify/tomorrow-night-eighties.min.css">
    
    <link rel="stylesheet" href="/css/main.css">

    
</head>


<body>
<header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
<div class="container">
    <a class="navbar-brand" href="/">&nbsp;<strong>w366er</strong>&nbsp;</a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
        aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
        <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <ul class="navbar-nav ml-auto text-center">
            
            <li class="nav-item">
                <a class="nav-link" href="/">Home</a>
            </li>
            
            <li class="nav-item">
                <a class="nav-link" href="/archives/">Archives</a>
            </li>
            
            <li class="nav-item">
                <a class="nav-link" href="/categories/">Categories</a>
            </li>
            
            <li class="nav-item">
                <a class="nav-link" href="/tags/">Tags</a>
            </li>
            
            <li class="nav-item">
                <a class="nav-link" href="/about/">About</a>
            </li>
            
        </ul>
    </div>
</div>


</nav>
    <div class="view intro-2"
         style="background: url('/img/post.jpg')no-repeat center center;background-size: cover;">
        <div class="full-bg-img">
            <div class="mask rgba-black-light flex-center">
                <div class="container text-center white-text wow fadeInUp">
                    <span class="h2" id="subtitle">
                        
                    </span>
                    
                        <br>
                        <p>星期一, 三月 23日 2020, 8:48 晚上</p>
                    
                </div>
            </div>
        </div>
    </div>
</header>

<main>
    
        

<div class="container-fluid">
    <div class="row">
        <div class="d-none d-lg-block col-lg-2"></div>
            <div class="col-lg-8 nopadding-md">
                <div class="py-5 z-depth-3 board">
                    <div class="post-content mx-auto">
                        <div class="markdown-body">
                            <h1 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h1><p>觉得自己太菜了，所以自己提高了一下题目的难度。结果这次密码题出难了，<del>_</del></p>
<h2 id="easy-aes"><a href="#easy-aes" class="headerlink" title="easy_aes"></a>easy_aes</h2><p>这道题是上古大三巨佬出的，比赛前把它拿来做了一下，题目出处：<a href="https://www.anquanke.com/post/id/175723#h2-1。" target="_blank" rel="noopener">https://www.anquanke.com/post/id/175723#h2-1。</a></p>
<p>本题考点：</p>
<ul>
<li><strong>1、zlib.compress 原理</strong></li>
<li><strong>2、AES</strong></li>
</ul>
<p>解题步骤：</p>
<ul>
<li><strong>1、找到合适的垃圾填充字符</strong></li>
<li><strong>2、爆破</strong></li>
</ul>
<p>prove 流程使用爆破就能通过了，校赛的时候也遇到过。zlib.compress 出处讲得非常详细，就不多说了。</p>
<p>然后通过密文长度不同的方式，找到垃圾填充字符。</p>
<p><img src="/images/recrution_march/test.jpg" alt></p>
<p>由于 zlib 的原因，一次爆破的长度是有限制的，所以保险一点就三位三位的爆破。</p>
<p>exp 如下：</p>
<pre><code>#! /usr/bin/python2.7
from pwn import *
import itertools
import string
from hashlib import md5

s = remote(&quot;47.98.156.31&quot;, 6226)
dic = string.ascii_letters + &#39;_-\{\}&#39;
print &quot;  [-] your dic is defined: &quot; + dic
s.recvuntil(&quot;str + &quot;)
salt = s.recv(4)
print &quot;  [-] salt is: &quot; + salt
s.recvuntil(&quot;== &quot;)
res = s.recv(5)
print &quot;  [-] res is: &quot; + res
s.recvuntil(&quot;[&gt;] Give me xxxxx:&quot;)
r = &#39;&#39;
for i in range(10000000):
    if md5(str(i) + salt).hexdigest().startswith(res):
        r = str(i)   
        break

s.sendline(r)
print &quot;  [-]proof sovled&quot;
flag = &#39;GWH&#39;
padd = &#39;!.$%^&amp;*-=&#39;
while True:
    now = flag[-2:]
    for i in dic:
        s.recvuntil(&quot;[&gt;] Please input your option:&quot;)
        s.sendline(&quot;E&quot;)
        s.recvuntil(&quot;[&gt;] Input your message:&quot;)
        tmp = now+i
        s.sendline(padd+tmp)
        s.recvuntil(&quot;The result is &quot;)
        res = s.recvline().strip()
        print res
        if len(res)==96:
            flag +=i
            print flag
            break</code></pre><h2 id="easyrsa"><a href="#easyrsa" class="headerlink" title="easyrsa"></a>easyrsa</h2><p>想着校赛的时候就考了一道已知高位 p, 所以这次学着出了一道。</p>
<p>本题考点：</p>
<ul>
<li><strong>1、Coppersmith Attack</strong></li>
<li><strong>2、二进制 Calculation</strong></li>
</ul>
<p>解题步骤：</p>
<ul>
<li><strong>1、补上爆破位</strong></li>
<li><strong>2、爆破</strong></li>
</ul>
<p>Coppersmith 方法需要已知 288 bits，这里 p 为 273 bits，还差 15 bits。</p>
<p>于是在已知 p 后补上爆破位，并且 range 为 2 ** 16。</p>
<p>exp 如下：</p>
<pre><code>#!/usr/bin/env sage
#-*- coding: utf-8 -*-
from sage.all import *
import binascii


n=0xafa5236a0f7859587285161d98682d1960e7ab63f2f2687113dc3119a4c42c531e1c859c06a7a4c94615f1b3234688d4de14a87712c9c252fe2a08b80e2c3957083928dc4cebbe10453d59c9c54f36d8be1be578f31aa668cd11862b9dd4c814a18a1ea3b2a6059c4f473e998c4ffce3b18c4ef36bf84a396ac827daab441387


cipher=0x5e3e72dd3e9d633fd3b99e2303ab31b429f046765cb23be2f4f13d32652f621979e29c71df2c9fde7adf3057b8d446295da656f42e358635205b926157e322b2a31e89582015eada144134d1f5090e6b735ad0576776537436c64055dfe978cb3c150359d7e3e6b4703c9d5ffe48790991126f040d4df1517c62c88acb48e634


e2 = 0x10001

pbits = 512

for i in range(0,2**16):
  p4=0x1f2458a57aaf9cbb2bb6045f5abf5d5d8b7556220d2740631cb9d67154d8e2b17e0670000
  p4 = p4 + int(hex(i),16)
  print &quot;    [-] p4.nbits: &quot;, p4.nbits()
  kbits = pbits - p4.nbits()  #未知需要爆破的比特位数
  p4 = p4 &lt;&lt; kbits 
  PR.&lt;x&gt; = PolynomialRing(Zmod(n))
  f = x + p4
  roots = f.small_roots(X=2^kbits, beta=0.4) #进行爆破

  #print roots
  if roots:        #爆破成功，求根
    p = p4+int(roots[0])
    assert n % p == 0
    q = n/int(p)
    phin = (p-1)*(q-1)
    d = inverse_mod(e2,phin)
    flag = pow(cipher,d,n)
    flag = hex(int(flag))[2:-1]
    print binascii.unhexlify(flag)</code></pre><h2 id="padding"><a href="#padding" class="headerlink" title="padding"></a>padding</h2><p>本来以为这题网上一搜就会有的，结果小朋友们都没有搜到。题目来源：<a href="https://github.com/ValarDragon/CTF-Crypto/blob/master/RSA/FranklinReiter.sage" target="_blank" rel="noopener">https://github.com/ValarDragon/CTF-Crypto/blob/master/RSA/FranklinReiter.sage</a></p>
<p>本题考点：</p>
<ul>
<li><strong>RSA Coppersmith’s short-pad attack</strong></li>
</ul>
<p>解题步骤：</p>
<ul>
<li><strong>构造 pad</strong></li>
</ul>
<p>exp 如下：</p>
<pre><code>#! /usr/bin/python
# Franklin-Reiter attack against RSA.
# If two messages differ only by a known fixed difference between the two messages
# and are RSA encrypted under the same RSA modulus N
# then it is possible to recover both of them.

# Inputs are modulus, known difference, ciphertext 1, ciphertext2.
# Ciphertext 1 corresponds to smaller of the two plaintexts. (The one without the fixed difference added to it)

import random
import math
import binascii


def franklinReiter(n,e,r,c1,c2):
    R.&lt;X&gt; = Zmod(n)[]
    f1 = X^e - c1
    f2 = (X + r)^e - c2
    # coefficient 0 = -m, which is what we wanted!
    return Integer(n-(compositeModulusGCD(f1,f2)).coefficients()[0])

  # GCD is not implemented for rings over composite modulus in Sage
  # so we do our own implementation. Its the exact same as standard GCD, but with
  # the polynomials monic representation
def compositeModulusGCD(a, b):
    if(b == 0):
        return a.monic()
    else:
        return compositeModulusGCD(b, a % b)

def CoppersmithShortPadAttack(e,n,C1,C2,eps=1/100):
    &quot;&quot;&quot;
    Coppersmith&#39;s Shortpad attack!
    Figured out from: https://en.wikipedia.org/wiki/Coppersmith&#39;s_attack#Coppersmith.E2.80.99s_short-pad_attack
    &quot;&quot;&quot;
    import binascii
    P.&lt;x,y&gt; = PolynomialRing(ZZ)
    ZmodN = Zmod(n)
    g1 = x^e - C1
    g2 = (x+y)^e - C2
    res = g1.resultant(g2)
    P.&lt;y&gt; = PolynomialRing(ZmodN)
    # Convert Multivariate Polynomial Ring to Univariate Polynomial Ring
    rres = 0
    for i in range(len(res.coefficients())):
        rres += res.coefficients()[i]*(y^(res.exponents()[i][1]))

    diff = rres.small_roots(epsilon=eps)
    # Test point here
    print rres
    recoveredM1 = franklinReiter(n,e,diff[0],C1,C2)
    print(recoveredM1)
    print(&quot;Message is the following hex, but potentially missing some zeroes in the binary from the right end&quot;)
    print(hex(recoveredM1))
    print(&quot;Message is one of:&quot;)
    for i in range(8):
        msg = hex(Integer(recoveredM1*pow(2,i)))
        if(len(msg)%2 == 1):
            msg = &#39;0&#39; + msg
        if(msg[:2]==&#39;0x&#39;):
            msg = msg[:2]
        print(binascii.unhexlify(msg))


n = 0x995d87f5e77364947de43de9a04dc7b3cb81976f4853c51f183adff5682cdf30ad30d9c33e076581e75f7ebe48f39ab10d42b7b182879db59d8f3961d9fb7b24dbfe7a3e5455977cf0f10e487843685d1586d395ab54c2de24423654b16efb2fe0c88c34c48fef292a87d0674a85b698520397fcf89605e354d8786fc6acaf65

e = 7

c1 = 0x27e34ccd3a7b6772c6ddaa953952dd16288f9bfac5fbd48fbaa42e9c22a08f8fd5e9a14396170178b1161ab0ab7b9cd06b20f78dc73fd29f92c3a5afa9672d21ce33c095b30ee997005d99deb108792f02f4be592e792a37b6f0312f96b4337e715e5465a54db9b5c16b461323fbbe3a560dfafd123d738ab6e9d4948fb4dc51

c2 = 0x7b5e8e881b904b900b56903ee9c3b62b65424dcccfac8fcb74921df8955ecb7f4d34abd900e4806b3ff32e637fcdf9ff9132e1d34b90d46d17855afd4ada6472e2bcf3be439aea1bd1551c405130788c388c24bf3684fab4e0044fdc2b00e5acecc5cd254b8053285d538f4a752d986b4603094300033402136f8eb050edf906

CoppersmithShortPadAttack(e, n, c1, c2)</code></pre><p>最后感谢大家参加本次的考核赛。</p>

                            <hr>
                        </div>
                        <br>
                        <div>
                            
                            <p>
                                <i class="iconfont icon-tag"></i>
                                
                                    <a class="hover-with-bg" href="/tags/Write%20up">Write up</a>
                                
                            </p>
                            
                                <p class="note note-warning">本博客所有文章除特别声明外，均采用 <a href="https://zh.wikipedia.org/wiki/Wikipedia:CC_BY-SA_3.0%E5%8D%8F%E8%AE%AE%E6%96%87%E6%9C%AC" rel="nofollow noopener">CC BY-SA 3.0协议</a> 。转载请注明出处！</p>
                            
                        </div>
                    </div>
                </div>
            </div>
        <div class="d-none d-lg-block col-lg-2 toc-container">
            
  <div id="toc">
    <p class="h4"><i class="far fa-list-alt"></i> Toc:</p> 
    <div id="tocbot"></div>
  </div>

        </div>
    </div>
</div>

<!-- custom -->


<!-- Comments -->
<div class="col-lg-7 mx-auto nopadding-md">
    <div class="container comments mx-auto" id="comments">
        
    </div>
</div>
    
</main>

<footer class="mt-5">
  <div class="text-center py-3">
    <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><b>Hexo</b></a>
    <i class="iconfont icon-love"></i>
    <a href="https://github.com/0x2e/Material-T" target="_blank" rel="nofollow noopener"> <b>Material-T</b></a>
    <br>
    
  </div>
</footer>

  <!-- SCRIPTS -->
  <script src="/lib/mdbootstrap/js/jquery-3.4.1.min.js"></script>
  <script src="/lib/mdbootstrap/js/popper.min.js"></script>
  <script src="/lib/mdbootstrap/js/bootstrap.min.js?v=4.3.1"></script>
  <script src="/lib/mdbootstrap/js/mdb.min.js?v=4.8.7"></script>
  <script src="/lib/nprogress/nprogress.min.js?v=0.2.0"></script>
  <script src="/js/main.js"></script>
  
    
      <script src="/lib/tocbot/tocbot.min.js?v=4.7.0"></script>
    
    <script src="/js/post.js"></script>
  
  
    <script src="/lib/prettify/prettify.min.js?v=0.1.0"></script>
    <script>
      $(document).ready(function(){
        $('pre').addClass('prettyprint linenums');
        prettyPrint();
      })
    </script>
  
  
    <script src="/lib/typed/typed.min.js?v=2.0.9"></script>
    <script>
        var typed = new Typed('#subtitle', {
          strings: [
            '  ',
            "2020_GWHT_三月考核赛_wp&nbsp;",
        ],
        cursorChar: "|",
        typeSpeed: 90,
        startDelay: 300, //开始之前延迟300毫秒
        loop: false,
        });
        $(".typed-cursor").addClass("h2");
    </script>
  
  
    <script src="/lib/anchor/anchor.min.js?v=4.2.0"></script>
    <script>
      anchors.options = {
        placement: "right",
        visible: "false",
        
      };
      anchors.add(".post-content > h1,h2,h3,h4,h5,h6");
    </script>
  
</body>
</html>